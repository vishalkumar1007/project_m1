image: golang:1.22

stages:
  - test
  - mirror
  - monitor

variables:
  # *** set these as GitLab CI/CD variables ***
  GITHUB_TOKEN: $GITHUB_PAT
  GITHUB_OWNER: your-github-org
  GITHUB_REPO: project_m1
  TARGET_BRANCH: $CI_COMMIT_REF_NAME

test:
  stage: test
  script:
    - go mod download
    - go test -v ./...        # runs all tests including main_test.go

monitor-github:
  stage: monitor
  image: registry.gitlab.com/vishalkumar1007-group/monitor_github_action_docker_project_m1:latest
  before_script:
    - echo "$DOCKER_PASSWORD" | docker login registry.gitlab.com -u "$DOCKER_USER" --password-stdin
  script:
    - echo "Streaming GitHub Actions logs for branch $TARGET_BRANCH â€¦"
    - /bin/monitor